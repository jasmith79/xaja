<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Xaja Test</title>
  <script src='../dist/xaja.min.js'></script>
</head>
<body>
  I'm a page!
  <script>
    if (!window.xaja) {
      throw new Error('Stop the world, Im broken!');
    }
    var p1 = xaja.get('test/test.txt', {foo: 'bar'});
    var p2 = xaja.post('test/test.txt', {foo: 'bar'});
    var p3 = xaja.getJSON('test/test.json');
    Promise.all([p1, p2, p3])
      .then(function(arr) {
        var json = arr.pop();
        var passed = arr.every(function(str) {
          return str.trim() === 'Received';
        }) && JSON.stringify(json) === '{"ya":"hoo"}';
        if (passed) {
          document.write("Passed on this end");
        } else {
          document.write("Failed! response was " + arr);
        }
      })
      .catch(function(err) {
        document.write("Error! " + err.message);
      });
  </script>
</body>
</html>
